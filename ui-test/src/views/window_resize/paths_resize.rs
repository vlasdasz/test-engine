use test_engine::{
    App,
    refs::Weak,
    ui::{Setup, StickView, UI, ViewData, view},
    ui_test::check_colors,
};

#[view]
struct PathsResize {
    #[init]
    stick: StickView,
}

impl Setup for PathsResize {
    fn setup(self: Weak<Self>) {
        self.stick.place().tl(20).size(200, 200);
    }
}

pub async fn test_paths_resize() -> anyhow::Result<()> {
    UI::init_test_view::<PathsResize>().await;

    check_colors(
        r#"
              36  208 -  89 124 149
              46  187 -   0   0   0
              66  172 - 255 255 255
             104  136 - 231 231 231
             122  114 - 231 231 231
             159   77 - 255 255 255
             186   59 - 255 255 255
             208   35 -  89 124 149
             213   29 -  89 124 149
             188  209 -  89 124 149
             176  203 -  89 124 149
             163  190 - 255 255 255
             149  174 - 255 255 255
             134  153 - 231 231 231
             117  131 - 231 231 231
              87   83 -   0   0   0
              76   66 - 255 255 255
              64   51 - 255 255 255
              48   35 -  89 124 149
              34   21 -  89 124 149
             116  248 -  89 124 149
             113  227 -  89 124 149
             110  180 - 255 255 255
             110  168 -   0   0   0
             110  140 - 231 231 231
             110  113 - 231 231 231
             112   67 - 255 255 255
             112   28 - 255 255 255
             113   19 -  89 124 149
             114    6 -  89 124 149
             235  115 -  89 124 149
             220  121 -  89 124 149
             170  121 - 255 255 255
             143  120 - 231 231 231
             110  120 - 231 231 231
              86  117 - 231 231 231
              55  116 - 255 255 255
              42  114 - 255 255 255
              25  112 - 255 255 255
               8  112 -  89 124 149
        "#,
    )
    .await?;

    App::set_window_size((280, 600)).await;

    check_colors(
        r#"
              16   33 -  89 124 149
              35   36 -  89 124 149
              70   41 - 255 255 255
             112   50 - 255 255 255
             142   57 - 255 255 255
             196   68 - 255 255 255
             221   70 -  89 124 149
             225   73 -  89 124 149
             184   87 - 255 255 255
             139   99 - 231 231 231
              88  109 - 231 231 231
              34  124 - 255 255 255
              10  129 -  89 124 149
               8  129 -  89 124 149
              33  134 - 255 255 255
              83  144 - 231 231 231
             135  152 - 231 231 231
             181  160 - 255 255 255
             209  171 -  89 124 149
             226  192 -  89 124 149
             213  198 -  89 124 149
             147  199 - 255 255 255
              75  202 - 255 255 255
              51  213 -  89 124 149
              94  259 -  89 124 149
             123  225 -  89 124 149
             118  106 - 231 231 231
             115   28 - 255 255 255
             113   13 -  89 124 149
             111    9 -  89 124 149
        "#,
    )
    .await?;

    App::set_window_size((600, 280)).await;

    check_colors(
        r#"
              15  215 -  89 124 149
              28  199 -  89 124 149
              36  161 - 255 255 255
              40   96 - 255 255 255
              41   50 -  89 124 149
              42   22 -  89 124 149
              48   12 -  89 124 149
              53   72 - 255 255 255
              69  153 - 255 255 255
              78  200 - 255 255 255
              82  220 -  89 124 149
              92  222 -  89 124 149
             103  181 - 255 255 255
             108  127 - 231 231 231
             115   77 - 231 231 231
             123   36 - 255 255 255
             128   15 -  89 124 149
             131    6 -  89 124 149
             136   32 - 255 255 255
             136   92 - 231 231 231
             145  170 - 255 255 255
             157  222 -  89 124 149
             159  223 -  89 124 149
             171  212 -  89 124 149
             174  153 - 255 255 255
             180   74 - 255 255 255
             196   32 -  89 124 149
             204   35 -  89 124 149
             184   85 - 255 255 255
             194  134 - 255 255 255
             233  137 -  89 124 149
             246   94 -  89 124 149
        "#,
    )
    .await?;

    Ok(())
}
