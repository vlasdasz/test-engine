use anyhow::Result;
use test_engine::{
    dispatch::from_main,
    ui::{Alert, UI, view},
    ui_test::{check_colors, inject_touches},
};

#[view]
struct AlertTestView {}

pub async fn test_alert() -> Result<()> {
    UI::init_test_view::<AlertTestView>().await;

    from_main(|| {
        Alert::show("Forogorn\nSopokok\nFergel");
    })
    .await;

    check_colors(
        r#"
             220  406 -  89 124 149
             220  394 - 255 255 255
             218  343 - 255 255 255
             166  296 - 255 255 255
             153  276 -  89 124 149
             205  210 - 255 255 255
             205  189 -  89 124 149
             221  235 - 255 255 255
             243  235 - 255 255 255
             265  270 - 255 255 255
             267  270 - 255 255 255
             267  270 - 255 255 255
             288  274 - 106 106 106
             310  274 - 255 255 255
             310  274 - 255 255 255
             320  274 -  49  49  49
             337  274 - 196 196 196
             337  274 - 196 196 196
             310  303 - 253 253 253
             282  291 -  13  13  13
             317  292 - 255 255 255
             328  292 - 255 255 255
             330  290 - 255 255 255
             330  238 - 255 255 255
             330  235 - 255 255 255
             330  235 - 255 255 255
             444  279 -  89 124 149
             414  279 - 255 255 255
             470  279 -  89 124 149
             475  279 -  89 124 149
             369  256 - 255 255 255
             332  256 - 255 255 255
             308  256 - 255 255 255
             190  288 - 255 255 255
        "#,
    )
    .await?;

    inject_touches(
        "
            338  373  b
            338  373  e
        ",
    )
    .await;

    check_colors(
        r#"
              69  503 -  89 124 149
              88  476 -  89 124 149
             103  418 -  89 124 149
             187  336 -  89 124 149
             258  285 -  89 124 149
             280  274 -  89 124 149
             280  274 -  89 124 149
             347  251 -  89 124 149
             429  153 -  89 124 149
             450  131 -  89 124 149
             524   72 -  89 124 149
        "#,
    )
    .await?;

    Ok(())
}
