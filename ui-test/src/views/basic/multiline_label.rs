use anyhow::Result;
use test_engine::{
    dispatch::from_main,
    refs::Weak,
    ui::{HasText, Label, Setup, UI, ViewData, view},
    ui_test::check_colors,
};

#[view]
struct MultilineLabel {
    #[init]
    label: Label,
}

impl Setup for MultilineLabel {
    fn setup(mut self: Weak<Self>) {
        self.label.place().tl(20).size(280, 280);
        self.label.set_text_size(40);
        self.label
            .set_text("|       Plati mne dengi bistrenko pliz.\nJa kuplu dengushki.\nA");
    }
}

pub async fn test_multiline() -> Result<()> {
    let mut view = UI::init_test_view::<MultilineLabel>().await;

    check_colors(
        r#"
               9  154 -  89 124 149
              27  150 - 255 255 255
              26  150 - 255 255 255
              32  151 - 255 255 255
              37  151 -   0   0   0
              38  151 - 151 151 151
              39  151 - 255 255 255
              35  151 - 160 160 160
              71  150 - 255 255 255
              89  151 - 255 255 255
              96  152 - 255 255 255
             117  150 - 255 255 255
             132  150 - 255 255 255
             138  151 - 255 255 255
             152  144 -   0   0   0
             163  150 -  69  69  69
             168  153 - 255 255 255
             183  152 -   0   0   0
             190  153 - 255 255 255
             220  155 - 255 255 255
             225  156 -  14  14  14
             247  153 -  14  14  14
             256  151 -  14  14  14
             264  151 - 255 255 255
             272  152 -  14  14  14
             276  156 - 255 255 255
             290  161 - 255 255 255
             306  155 -  89 124 149
             288  154 - 255 255 255
             261  154 -  14  14  14
             229  156 - 255 255 255
             217  155 - 255 255 255
             192  155 - 131 131 131
             169  149 - 208 208 208
             150  149 -  79  79  79
             127  142 -  93  93  93
             135  140 - 255 255 255
             158  139 - 255 255 255
             177  153 - 255 255 255
             194  154 -   0   0   0
             208   85 - 255 255 255
        "#,
    )
    .await?;

    from_main(move || {
        view.label.multiline = true;
    });

    check_colors(
        r#"
              12   51 -  89 124 149
              21   55 - 255 255 255
              35   56 - 160 160 160
              49   56 - 255 255 255
              84   57 - 255 255 255
             111   57 - 255 255 255
             156   57 - 255 255 255
             184   55 -   0   0   0
             215   55 -  14  14  14
             238   55 -  14  14  14
             261   53 -  43  43  43
             288   49 - 255 255 255
             310   48 -  89 124 149
             309   80 -  89 124 149
             307   83 -  89 124 149
             289   86 - 255 255 255
             266   91 - 210 210 210
             251   94 - 255 255 255
             225   94 -  14  14  14
             204   93 - 113 113 113
             186   93 - 255 255 255
             151   93 -  14  14  14
             134   96 - 255 255 255
             104   94 - 255 255 255
              68   99 - 255 255 255
              39  100 - 255 255 255
              24  105 - 255 255 255
              12  108 -  89 124 149
              15  118 -  89 124 149
              30  129 - 255 255 255
              82  131 - 255 255 255
             117  132 - 255 255 255
             130  135 -  29  29  29
             162  140 - 255 255 255
             183  140 - 255 255 255
             218  142 - 255 255 255
             274  144 - 255 255 255
             321  148 -  89 124 149
             321  154 -  89 124 149
             280  161 - 255 255 255
             236  169 - 255 255 255
             216  171 -   0   0   0
             204  172 - 255 255 255
             182  170 - 255 255 255
             143  173 -   0   0   0
             134  177 - 255 255 255
             112  178 - 255 255 255
              86  183 - 124 124 124
              55  191 - 255 255 255
              23  211 - 255 255 255
              57  215 - 255 255 255
              94  214 - 255 255 255
             112  214 -  14  14  14
             137  215 - 255 255 255
             162  215 - 255 255 255
             178  215 -   0   0   0
             195  216 - 255 255 255
             204  214 - 255 255 255
             212  214 -   0   0   0
             236  215 - 255 255 255
             260  219 - 255 255 255
             262  230 - 255 255 255
             186  254 - 255 255 255
             172  259 - 255 255 255
             148  261 - 255 255 255
             158  335 -  89 124 149
        "#,
    )
    .await?;

    Ok(())
}
