use anyhow::Result;
use test_engine::{
    gm::Apply,
    refs::Weak,
    ui::{Anchor::Top, Button, HasText, ORANGE, Setup, Style, UI, ViewData, ViewSubviews, view},
    ui_test::check_colors,
};

const MENU_BUTTON: Style = Style::new(|view| {
    view.set_color((75, 129, 244));
    view.set_corner_radius(20);
    view.place().size(280, 100).l(50);

    if let Some(mut view) = view.downcast_view::<Button>() {
        view.set_text_color(ORANGE);
        view.set_text_size(64);
    }
});

#[view]
struct Styles {
    #[init]
    button_1: Button,
    button_2: Button,
    button_3: Button,
}

impl Setup for Styles {
    fn setup(mut self: Weak<Self>) {
        [self.button_1, self.button_2, self.button_3].apply(|mut button| {
            button.apply_style(MENU_BUTTON);
        });

        self.button_1.set_text("Button 1").place().t(50);

        self.button_2.set_text("Button 2");
        self.button_2.place().anchor(Top, self.button_1, 40);

        self.button_3.set_text("Button 3");
        self.button_3.place().anchor(Top, self.button_2, 40);
    }
}

pub async fn test_styles() -> Result<()> {
    UI::init_test_view::<Styles>().await;

    check_colors(
        r#"
              45  440 -  89 124 149
              45  435 -  89 124 149
              84  395 - 255 203  12
             106  382 - 255 203  12
             127  371 -  75 129 244
             135  369 -  75 129 244
             150  359 -  75 129 244
             185  333 -  75 129 244
             185  333 -  75 129 244
             204  304 -  89 124 149
             204  304 -  89 124 149
             236  228 - 193 171 180
             238  221 -  75 129 244
             250  211 -  75 129 244
             258  199 -  75 129 244
             258  191 -  75 129 244
             261  154 -  89 124 149
             292   94 - 255 203   0
             293   93 - 255 203   0
             325   53 -  89 124 149
             326   51 -  89 124 149
             295   56 -  75 129 244
             228   59 -  75 129 244
             212   59 -  75 129 244
              47   48 -  89 124 149
              47   48 -  89 124 149
              57   54 -  75 129 244
              59   58 -  75 129 244
              59   73 -  75 129 244
              59   73 -  75 129 244
              69   73 -  75 129 244
              73   75 -  75 129 244
              73   79 -  75 129 244
              78   83 - 255 203  12
             108   89 -  75 129 244
             112   92 -  75 129 244
             118   94 - 255 203   0
             119   94 - 255 203   0
             141  153 -  89 124 149
             145  157 -  89 124 149
             150  163 -  89 124 149
             155  171 -  89 124 149
             202  180 -  89 124 149
             202  204 -  75 129 244
             209  220 -  75 129 244
             233  239 -  75 129 244
             241  313 -  89 124 149
             243  334 -  75 129 244
             246  365 - 255 203   0
             248  370 - 255 203   0
             363  458 -  89 124 149
             354  455 -  89 124 149
             328  449 -  89 124 149
             314  433 -  89 124 149
             292  411 -  75 129 244
             282  411 -  75 129 244
             257  411 -  75 129 244
             201  402 -  75 129 244
             105  370 - 198 174 174
              66  344 -  75 129 244
              63  339 -  75 129 244
              63  339 -  75 129 244
              63  271 -  75 129 244
              63  271 -  75 129 244
              39  264 -  89 124 149
              39  264 -  89 124 149
              39  262 -  89 124 149
              39  256 -  89 124 149
              39  209 -  89 124 149
              39  187 -  89 124 149
              39   69 -  89 124 149
              39   67 -  89 124 149
             194   54 -  75 129 244
             197   55 -  75 129 244
             197   55 -  75 129 244
             207   51 -  75 129 244
             268   48 -  89 124 149
             277   48 -  89 124 149
             277   48 -  89 124 149
             264  128 -  75 129 244
             264  198 -  75 129 244
             264  198 -  75 129 244
             204  228 -  84 131 242
             201  228 -  75 129 244
             136  260 -  75 129 244
             136  271 -  75 129 244
             152  400 -  75 129 244
             149  513 -  89 124 149
        "#,
    )
    .await?;

    Ok(())
}
